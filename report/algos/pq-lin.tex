%!TEX root=../main.tex

\begin{algorithm}
\caption{Linearizability Monitoring for Priority Queue Histories with Distinct Values}
\algolabel{pq-algo}
\myproc{\PQLin{$H$}}{
$Events \gets \bigcup_{o\in H}\set{\tuple{\resTimeOf{o}, 0, o}, \tuple{\invTimeOf{o}, 1, o}}$\;
Sort $Events$ in ascending order\;
\tcp{Let $RunningOp$ be a treemap mapping values to a hashtable of operations, $CritVal$ be a treeset, and $EndedVal$ be a hashtable}
\For{$\tuple{t, e, o} \in Events$}
{
    \If{$e = 1$}
    {
        \lIf{$\methodOf{o} \neq \minsert$}{ $RunningOp[\valOf{o}]$.insert($o$) }

        \If{$\methodOf{o} = \poll$}
        {
            $CritVal$.remove($\valOf{o}$)\;
            $EndedVal$.insert($\valOf{o}$)\;
        }
    }
    \Else
    {
        \lIf{ $RunningOp[\valOf{o}]$.contains($o$) }{ return false }

        \lIf{$\methodOf{o} = \minsert$ \AND \NOT $EndedVal$.contains($\valOf{o}$)}{ $CritVal$.insert($\valOf{o}$)}
    }
    \;
    \lIf{$CritVal$.empty()}{$RunningOp$.clear()}
    \Else
    {
        $MaxValue \gets CritVal$.last()\;
        \While{\NOT $RunningOp$.empty()} {
            $MaxRunningVal \gets RunningOp$.lastKey()\;
            \lIf{$MaxRunningVal < MaxValue$}{ \Break }
            $RunningOp$.remove($MaxRunningVal$);\;
        }
    }
}

\Return true
}
\end{algorithm}